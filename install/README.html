<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Installation of MALA &mdash; Materials Learning Algorithms (MALA)  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/mala_favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="External modules" href="external_modules.html" />
    <link rel="prev" title="Installation" href="../installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html">
            <img src="../_static/mala_horizontal_white.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../installation.html">Installation</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Installation of MALA</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#prerequisites">Prerequisites</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#python-version">Python version</a></li>
<li class="toctree-l4"><a class="reference internal" href="#python-packages">Python packages</a></li>
<li class="toctree-l4"><a class="reference internal" href="#optional-python-packages">Optional python packages</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#installing-the-mala-package">Installing the MALA package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#build-documentation-locally-optional">Build documentation locally (optional)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#downloading-and-adding-example-data">Downloading and adding example data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="external_modules.html">External modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="on_cluster.html">Using MALA on HPC systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="tested_systems.html">Successfully tested on</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/modules.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTE.html">Contributing to MALA</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Materials Learning Algorithms (MALA)</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../installation.html">Installation</a> &raquo;</li>
      <li>Installation of MALA</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com//mala-project/mala/blob/develop/docs/source/install/README.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="installation-of-mala">
<h1>Installation of MALA<a class="headerlink" href="#installation-of-mala" title="Permalink to this headline"></a></h1>
<p>This document details the manual installation of the MALA package.</p>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline"></a></h2>
<div class="section" id="python-version">
<h3>Python version<a class="headerlink" href="#python-version" title="Permalink to this headline"></a></h3>
<p>MALA itself is not bound to a certain python version, as long as the package requirements for MALA can be met by the
version of your choice. MALA has been successfully tested for python 3.8.5.
If you intend to use the optional Quantum Espresso total energy module or LAMMPS and install these software packages
yourself the necessary python bindings will be created for your python version. If you operate on a machine that
provides pre-installed versions of these packages (e.g. on an HPC cluster), you need to adhere to the python version
for which these python bindings have been created. A list of machines on which MALA was tested can be found in
<a class="reference internal" href="tested_systems.html"><span class="doc std std-doc">Successfully tested on</span></a>.</p>
</div>
<div class="section" id="python-packages">
<h3>Python packages<a class="headerlink" href="#python-packages" title="Permalink to this headline"></a></h3>
<p>In order to run MALA you have to have the following packages installed:</p>
<ul class="simple">
<li><p>torch (PyTorch)</p></li>
<li><p>numpy</p></li>
<li><p>scipy</p></li>
<li><p>oapackage</p></li>
<li><p>tensorboard</p></li>
<li><p>optuna</p></li>
<li><p>ase</p></li>
<li><p>mpmath</p></li>
</ul>
<p>See also the <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file.
You can install each Python package with</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ pip install packagename
</pre></div>
</div>
<p>or all with</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ pip install -r requirements.txt
</pre></div>
</div>
<p>or just install the package along with its basic dependencies</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ pip install -e .
</pre></div>
</div>
<p>In order to install additional dependencies (enabling optional features, building documentaion locally, testing etc.) do</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ pip install -e .<span class="o">[</span>opt,test,doc<span class="o">]</span>
</pre></div>
</div>
<p>See below for what the <code class="docutils literal notranslate"><span class="pre">-e</span></code> option does.</p>
<p>Note that we exclude <code class="docutils literal notranslate"><span class="pre">torch</span></code> in <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> We don’t want torch to be
installed automatically, just note that we need it. For local testing, people
might want to install the CPU-only version using something like</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ pip install <span class="nv">torch</span><span class="o">==</span><span class="m">1</span>.7.1+cpu <span class="nv">torchvision</span><span class="o">==</span><span class="m">0</span>.8.2+cpu <span class="se">\</span>
    <span class="nv">torchaudio</span><span class="o">==</span><span class="m">0</span>.7.2 -f <span class="se">\</span>
    https://download.pytorch.org/whl/torch_stable.html
</pre></div>
</div>
<p>while a plain <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">torch</span></code> will pull the much larger GPU version by
default.</p>
<p>For other ways to install PyTorch you might also refer to <a class="reference external" href="https://pytorch.org/">https://pytorch.org/</a>.</p>
</div>
<div class="section" id="optional-python-packages">
<h3>Optional python packages<a class="headerlink" href="#optional-python-packages" title="Permalink to this headline"></a></h3>
<p>MALA uses some optional packages that have to be installed manually:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">lammps</span></code>: Enables the calculation of descriptors, see <a class="reference internal" href="external_modules.html"><span class="doc std std-doc">the instructions on external modules</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">total_energy</span></code>: Enables the calculation of the total energy, see <a class="reference internal" href="external_modules.html"><span class="doc std std-doc">the instructions on external modules</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mpi4py</span></code>: Enables inference parallelization</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">horovod</span></code>: Enables training parallelization</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">oapackage</span></code>: Enables usage of OAT method for hyperparameter optimization</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pqkmeans</span></code>:  Enables clustering of training data</p></li>
</ul>
<p>MALA can be used without these packages, an error will only occure when attempting
perform an operation these packages are crucial for. With the exception
of <code class="docutils literal notranslate"><span class="pre">lammps</span></code> and <code class="docutils literal notranslate"><span class="pre">total_energy</span></code>, these packages can be installed using
<code class="docutils literal notranslate"><span class="pre">pip</span></code>.</p>
<div class="section" id="conda-environment-optional">
<h4>Conda environment (optional)<a class="headerlink" href="#conda-environment-optional" title="Permalink to this headline"></a></h4>
<p>Alternatively to pip, you can install the required packages within a
<a class="reference external" href="https://docs.conda.io/en/latest/miniconda.html">conda</a> environment.
We provide four different environment files, depending on the architecture and
ganularity of dependencies specified (find them in the <code class="docutils literal notranslate"><span class="pre">install</span></code> folder).
We use the explicit environment files for our reproducible and tested builds. Feel free to
start off with a basic environment file specifing only the direct dependencies (these
files will likely install newer versions of (sub-)dependencies and we cannot guarantee everything to work).</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>dependency granularity:</th>
<th>basic</th>
<th>explicit</th>
</tr>
</thead>
<tbody>
<tr>
<td>CPU</td>
<td><code>mala_cpu_base_environment.yml</code></td>
<td><code>mala_cpu_environment.yml</code></td>
</tr>
<tr>
<td>GPU</td>
<td><code>mala_gpu_base_environment.yml</code></td>
<td><code>mala_gpu_environment.yml</code></td>
</tr>
</tbody>
</table>
<p>Follow the steps below to set up the necessary environment.</p>
<ol class="arabic">
<li><p>(optional) If needed, specify the python version you want to use in this
environment by replacing <code class="docutils literal notranslate"><span class="pre">3.6</span></code> with your desired version in <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">dependencies</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python&gt;=yourversionhere</span><span class="w"></span>
</pre></div>
</div>
</li>
<li><p>Create an environment <code class="docutils literal notranslate"><span class="pre">mala</span></code>:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ conda env create -f environment.yml
</pre></div>
</div>
</li>
<li><p>Activate the new environment:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ conda activate mala
</pre></div>
</div>
</li>
<li><p>You can deactivate the environment with:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ conda deactivate
</pre></div>
</div>
</li>
<li><p>You can update your conda environment by making changes to environment.yml:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ conda env update --name mala  --file environment.yml
</pre></div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="section" id="installing-the-mala-package">
<h2>Installing the MALA package<a class="headerlink" href="#installing-the-mala-package" title="Permalink to this headline"></a></h2>
<ol class="arabic">
<li><p>Make sure that all prerequisites are fulfilled (see above)</p></li>
<li><p>Install the package using</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ~/path/to/this/git/root/directory
$ pip install -e .
</pre></div>
</div>
<p>(note: the <code class="docutils literal notranslate"><span class="pre">-e</span></code> is absolutely crucial, so that changes in the code will be
reflected system wide)</p>
</li>
<li><p>(Optional): Download example data (see below) to run the examples.</p></li>
</ol>
<div class="section" id="build-documentation-locally-optional">
<h3>Build documentation locally (optional)<a class="headerlink" href="#build-documentation-locally-optional" title="Permalink to this headline"></a></h3>
<p>Install the prerequisites:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ pip install -r docs/requirements.txt
</pre></div>
</div>
<ol class="arabic simple">
<li><p>Change into <code class="docutils literal notranslate"><span class="pre">docs/</span></code> folder.</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">apidocs</span></code> on Linux/macOS or <code class="docutils literal notranslate"><span class="pre">.\make.bat</span> <span class="pre">apidocs</span></code> on Windows.</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">html</span></code> on Linux/macOS or <code class="docutils literal notranslate"><span class="pre">.\make.bat</span> <span class="pre">html</span></code> on Windows. This creates a <code class="docutils literal notranslate"><span class="pre">_build</span></code> folder inside <code class="docutils literal notranslate"><span class="pre">docs</span></code>. You may also want to use <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">html</span> <span class="pre">SPHINXOPTS=&quot;-W&quot;</span></code> sometimes. This treats warnings as errors and stops the output at first occurence of an error (useful for debugging rST syntax).</p></li>
<li><p>Open <code class="docutils literal notranslate"><span class="pre">docs/_build/html/index.html</span></code>.</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">clean</span></code> on Linux/macOS or <code class="docutils literal notranslate"><span class="pre">.\make.bat</span> <span class="pre">clean</span></code> on Windows. if required (e.g. after fixing erros) and building again</p></li>
</ol>
</div>
</div>
<div class="section" id="downloading-and-adding-example-data">
<h2>Downloading and adding example data<a class="headerlink" href="#downloading-and-adding-example-data" title="Permalink to this headline"></a></h2>
<p>The examples and tests need additional data to run. The MALA team provides a
data repository, that can be obtained from
<a class="reference external" href="https://github.com/mala-project/test-data">https://github.com/mala-project/test-data</a>. Please be sure to check out the
correct tag for the data repository, since the data repository itself is
subject to ongoing development as well.</p>
<p>Download data repository and check out correct tag.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/mala-project/test-data ~/path/to/data/repo
$ <span class="nb">cd</span> ~/path/to/data/repo
$ git checkout v1.1.0
</pre></div>
</div>
<p>Export</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">MALA_DATA_REPO</span><span class="o">=</span>~/path/to/data/repo
</pre></div>
</div>
<p>pointing to that repo. This will be used by tests and examples.</p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="external_modules.html" class="btn btn-neutral float-right" title="External modules" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021 National Technology &amp; Engineering Solutions of Sandia, LLC (NTESS). Under the terms of Contract DE-NA0003525 with NTESS, the U.S. Government retains certain rights in this software. Attila Cangi, J. Austin Ellis, Lenz Fiedler, Daniel Kotik, Normand Modine, Sivasankaran Rajamanickam, Steve Schmerler, Aidan Thompson.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>